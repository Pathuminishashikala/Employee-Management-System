"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_copilot-chat_components_Chat_tsx"],{75095:(e,t,s)=>{s.d(t,{r:()=>ey});var n,a=s(74848),i=s(46988),o=s(38568),r=s(38621),l=s(75177),c=s(63867),d=s(55847),m=s(84217),u=s(52464),h=s(30729),p=s(96540),x=s(2120),g=s(39363),f=s(82610),j=s(93589),y=s(77342),b=s(2622),v=s(65615),C=s(7426),N=s(56212),A=s(47173);let _={legalText:"Chat-module__legalText--wsTEU"};var k=s(6773),S=s(78176),w=s(56056),R=s(26871),E=s(72160),T=s(8338);let I={ActionList_Heading:"CopilotSuggestions-module__ActionList_Heading--ArthG"},M=({suggestionKind:e})=>{let t=(0,v.Pk)(),s=(0,C.b)(),n=(0,p.useCallback)(e=>{s.sendChatMessage({thread:s.getSelectedThread(t),content:e.prompt??e.question,intent:e.intent,modeOverride:e.mode,references:t.currentReferences,topic:t.currentTopic,context:t.context}),(0,i.BI)("copilot_generated_suggestion_click",{intent:e.intent,mode:e.mode,contextType:t.context?.[0]?.type,content:e.question})},[s,t]),o=(0,p.memo)(function({suggestion:e}){return(0,a.jsxs)(T.l.Item,{onSelect:()=>n(e),sx:{mx:0,border:"1px solid",borderColor:"border.default",width:"fit-content"},children:[(0,a.jsx)(T.l.LeadingVisual,{children:(0,a.jsx)(h.A,{icon:r.PaperAirplaneIcon})}),(0,a.jsxs)("span",{children:[" ",e.question]})]})}),l="loading"===t.messagesLoading.state||!!t.streamingMessage,{suggestions:c}=t,d=t.currentReferences[0],m=1===t.currentReferences.length&&d?.type==="repository"&&d.id===t.currentRepository?.id;return!l&&(b.W.topicsAsReferences?m:!t.showTopicPicker&&0===t.currentReferences.length)&&c&&c.suggestions?(0,a.jsxs)(T.l,{className:"copilot-suggestions",sx:{pt:0,pb:3,display:"flex",gap:2,flexDirection:"column"},children:["initial"===e&&(0,a.jsx)(T.l.Heading,{as:"h2",className:I.ActionList_Heading,children:function(e){return e?`Ask about the ${e.replace(/-/g," ")}:`:"Ask anything:"}(c.referenceType)}),c?.suggestions.map(e=>a.jsx(o,{suggestion:e},e.question))]}):null},z=(0,p.memo)(M);try{M.displayName||(M.displayName="CopilotSuggestions")}catch{}try{(n=CopilotSuggestion).displayName||(n.displayName="CopilotSuggestion")}catch{}var B=s(97891),P=s(89401),W=s(88117),L=s(10871),D=s(87330);let F={container:"CustomBanner-module__container--uV55s",expanded:"CustomBanner-module__expanded--fDTFJ",actions:"CustomBanner-module__actions--tUuz0",iconButton:"CustomBanner-module__iconButton--WWgYX",content:"CustomBanner-module__content--xhiU7",icon:"CustomBanner-module__icon--WrRHA"};function U({icon:e,content:t,actions:s,onDismiss:n}){let i=(0,p.useRef)(null),[o,l]=(0,p.useState)(!1);return(0,p.useEffect)(()=>{let e=i.current;if(!e)return;let t=new ResizeObserver(t=>{for(let s of t)s.target===e&&(s.contentRect.height>40?l(!0):l(!1))});return t.observe(e),()=>{t.disconnect()}},[]),(0,a.jsxs)("div",{ref:i,className:`${F.container} ${o?F.expanded:""}`,children:[(0,a.jsx)("div",{className:F.icon,children:e}),(0,a.jsx)("div",{className:F.content,children:t}),(0,a.jsxs)("div",{className:F.actions,children:[s,n&&(0,a.jsx)(D.K,{className:F.iconButton,variant:"invisible",icon:r.XIcon,size:"medium","aria-label":"Close",onClick:n})]})]})}try{U.displayName||(U.displayName="CustomBanner")}catch{}function $(){let{resetDate:e}=(0,W.x)(),t=(0,a.jsx)(r.InfoIcon,{}),s=(0,a.jsxs)(a.Fragment,{children:["You have reached your free plan limit. It will reset on ",e]}),n=(0,a.jsx)(L.z,{as:"a",href:"https://github.com/features/copilot#pricing",onClick:()=>{(0,i.BI)("dotcom_chat.activate",{target:"QUOTA_EXCEEDED_BANNER_LINK_UPGRADE",mode:"assistive"})},children:"Upgrade"});return(0,a.jsx)(U,{icon:t,content:s,actions:n})}try{$.displayName||($.displayName="QuotaExceededBanner")}catch{}var G=s(34614);let O={container:"QuotaExceededEmptyState-module__container--ZMWEG",main:"QuotaExceededEmptyState-module__main--g2hJz",hero:"QuotaExceededEmptyState-module__hero--IrY09",copy:"QuotaExceededEmptyState-module__copy--VyrMt",heading:"QuotaExceededEmptyState-module__heading--LzJGU",description:"QuotaExceededEmptyState-module__description--KbMyl",footer:"QuotaExceededEmptyState-module__footer--evZ9_"};function Q(){let{resetDate:e}=(0,W.x)();return(0,a.jsxs)("div",{className:O.container,children:[(0,a.jsxs)("div",{className:O.main,children:[(0,a.jsx)("img",{className:O.hero,src:"/images/modules/copilot-immersive-v1/hero.png",alt:"Hero"}),(0,a.jsxs)("div",{className:O.copy,children:[(0,a.jsx)("h2",{className:O.heading,children:"You\u2019ve reached your free plan limit"}),(0,a.jsxs)("p",{className:O.description,children:["Your limits will reset on ",e,"."]}),(0,a.jsx)(L.z,{as:"a",variant:"primary",href:"https://github.com/features/copilot#pricing",onClick:()=>{(0,i.BI)("dotcom_chat.activate",{target:"QUOTA_EXCEEDED_EMPTY_STATE_LINK_UPGRADE",mode:"assistive"})},children:"Upgrade"})]})]}),(0,a.jsxs)("div",{className:O.footer,children:[(0,a.jsx)("strong",{children:"Part of an organization?"}),(0,a.jsxs)("span",{children:["Upgrade to"," ",(0,a.jsx)(G.A,{href:"https://github.com/github-copilot/business_signup/choose_business_type?cft=copilot_li.features_copilot.cfb",inline:!0,children:"Copilot Business"})," ","to enable across teams."]})]})]})}try{Q.displayName||(Q.displayName="QuotaExceededEmptyState")}catch{}var H=s(37937);let q={container:"QuotaMeterBanner-module__container--QJsKZ"};function J(){let{isLicensedLimited:e,chatQuotaRemaining:t}=(0,W.x)(),[s,n]=(0,p.useState)(()=>H.J.getMeterBannerFlag()??!1);if((0,p.useEffect)(()=>{if(e&&void 0!==t){let e=H.J.getMeterBannerFlag();t>0&&t<=10?null===e?(H.J.setMeterBannerFlag(!0),n(!0)):n(e):(H.J.removeMeterBannerFlag(),n(!1))}},[e,t]),!s||void 0===t)return null;let o=(0,a.jsx)(r.InfoIcon,{}),l=(0,a.jsx)(a.Fragment,{children:"You only have a few free responses remaining."}),c=(0,a.jsx)(L.z,{as:"a",href:"https://github.com/features/copilot#pricing",onClick:()=>{(0,i.BI)("dotcom_chat.activate",{target:"QUOTA_METER_BANNER_LINK_UPGRADE",mode:"assistive"})},children:"Upgrade"});return(0,a.jsx)("div",{className:q.container,children:(0,a.jsx)(U,{icon:o,content:l,actions:c,onDismiss:()=>{H.J.setMeterBannerFlag(!1),n(!1)}})})}try{J.displayName||(J.displayName="QuotaMeterBanner")}catch{}var K=s(10967);function Y(){let{currentTopic:e}=(0,v.Pk)(),t=(0,f.P)(e),s=(0,f.Z6)(e),n=null;e&&s&&(n=`${e.ownerLogin}/${e.name}`);let i=t?e.repos:n?[n]:[],[o,r]=(0,K.M8)(i),l=o.requestStatus===K.xG.CanIndex&&(s&&o.code===K.W5.Unindexed||t&&o.docs===K.W5.Unindexed),c=(0,p.useRef)(!1);return(0,p.useEffect)(function(){let e=t?o.docs:o.code;!c.current&&e===K.W5.Unindexed&&l&&(c.current=!0,r())},[o.code,o.docs,t,l,r]),(0,a.jsx)(a.Fragment,{})}try{Y.displayName||(Y.displayName="TopicIndexedMessage")}catch{}var V=s(31806);function Z(){let{currentTopic:e}=(0,v.Pk)(),t=(0,v.pn)(e=>e.currentReferences.find(e=>"docset"===e.type)),s=e??t,n=(0,p.useRef)(null);return s?(0,a.jsx)(V.Z,{icon:(0,a.jsx)(r.RepoIcon,{}),topic:s,removeButtonRef:n}):null}try{Z.displayName||(Z.displayName="TopicIndicator")}catch{}var X=s(70642),ee=s(8932);function et({mode:e}){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.A,{sx:{height:"3rem",mb:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(ee.A,{})}),(0,a.jsx)(m.A,{as:"h1",sx:{textAlign:"center",fontSize:3,mb:2},children:"Ask Copilot"}),(0,a.jsx)(u.A,{as:"p",sx:{textAlign:"center",color:"fg.muted",mb:"immersive"===e?5:3,px:3,textWrap:"balance"},children:"Select a repository to get started. Ask questions about your codebase to get answers fast and learn your way around."})]})}try{et.displayName||(et.displayName="ChatWithCopilotHeader")}catch{}var es=s(62456);function en({docset:e,size:t}){return(0,a.jsx)(es.r,{src:e.avatarUrl,square:"organization"===e.ownerType,size:t})}try{en.displayName||(en.displayName="KnowledgeBaseAvatar")}catch{}var ea=s(70170),ei=s(67138),eo=s(91189),er=s(96558),el=s(59010);function ec(){let e=(0,C.b)(),{currentRepository:t,mode:s,selectedThreadID:n}=(0,v.Pk)(),[i,o]=(0,p.useState)(""),d=(0,ea.s)(e=>o(e),400,{start:!1}),[m,h]=(0,p.useState)(void 0),x=(0,p.useCallback)(()=>h(void 0),[]),g=(0,p.useCallback)(async t=>{if(x(),void 0===t){e.showTopicPicker(!1),e.clearCurrentTopic(),e.clearCurrentReferences(),"immersive"===s&&window.history.pushState(null,"","/copilot"),n&&H.J.setSelectedTopic(n,null);return}await e.fetchCurrentRepo(Number(t)),e.showTopicPicker(!1)},[x,e,s,n]),{repositories:f,loading:j}=(0,eo.U)(i,m,h,!0,t,4),y=(0,p.useMemo)(()=>j?"Loading repositories":0===f.length?"No repositories found":1===f.length?"1 repository found":`${f.length} repositories found`,[j,f.length]);return(0,a.jsxs)(l.A,{sx:{border:"1px solid var(--borderColor-default, var(--color-border-default))",borderRadius:2,display:"flex",flexDirection:"column",mb:3},children:[(0,a.jsx)(l.A,{sx:{p:3,pb:0},children:(0,a.jsx)(ei.A,{id:er.uN,leadingVisual:r.SearchIcon,name:"topic-search","aria-label":"Search repositories to chat about",placeholder:"Search repositories to chat about",onChange:e=>d(e.target.value),sx:{width:"100%","input:placeholder-shown":{textOverflow:"ellipsis"}}})}),(0,a.jsxs)(T.l,{children:[(0,a.jsx)("div",{role:"status",className:"sr-only",children:y}),j?(0,a.jsx)(l.A,{as:"li",sx:{display:"flex",justifyContent:"center",py:2,height:"190px",alignItems:"center"},children:(0,a.jsx)(c.A,{})}):0===f.length?(0,a.jsxs)(T.l.Item,{disabled:!0,children:[(0,a.jsx)(T.l.LeadingVisual,{sx:{color:"fg.muted"},children:(0,a.jsx)(r.CircleSlashIcon,{})}),(0,a.jsx)(u.A,{sx:{color:"fg.muted"},children:"No results found"})]}):(0,a.jsx)(a.Fragment,{children:f.length>0&&(0,a.jsxs)(T.l.Group,{children:[(0,a.jsx)(T.l.GroupHeading,{as:"h3",children:"Recent repositories"}),f.map(e=>(0,a.jsx)(el.W,{repo:e,onSelect:g,trailingVisualComponent:(0,a.jsx)(r.ArrowRightIcon,{})},e.nwo))]})}),(0,a.jsx)(T.l.Divider,{sx:{marginInline:0}}),(0,a.jsxs)(T.l.Item,{id:"chat-with-no-context",onSelect:()=>g(void 0),sx:{"#chat-with-no-context--label":{marginBottom:"0px !important"}},children:["General purpose chat",(0,a.jsx)(T.l.TrailingVisual,{children:(0,a.jsx)(r.ArrowRightIcon,{})})]},"chat-with-no-context")]})]})}try{ec.displayName||(ec.displayName="TopicList")}catch{}let ed=()=>{let e=(0,v.Pk)(),t=(0,p.useMemo)(()=>e.ssoOrganizations?e.ssoOrganizations.map(e=>e.login):[],[e.ssoOrganizations]);return(0,a.jsx)(l.A,{sx:{display:"flex",flexDirection:"column",flexGrow:1,height:"100%"},children:(0,a.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[(0,a.jsx)(et,{mode:e.mode}),(0,a.jsx)(l.A,{sx:{px:3,"> button":{m:"0 auto"}},children:(0,a.jsx)(ec,{})}),(0,a.jsx)(X.x,{portalContainerName:P.E5,protectedOrgs:t,redirectURI:()=>`/search/refresh_blackbird_caches?return_to=${location.href}`,sx:{mx:3,mb:3}}),(0,a.jsx)(em,{currentTopic:e.currentTopic})]})})};function em({currentTopic:e}){return(0,f.P)(e)?(0,a.jsx)(l.A,{sx:{mt:3,mb:4},children:(0,a.jsx)(eu,{docset:e})}):null}function eu({docset:e}){return(0,a.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",gap:3,border:"1px solid var(--borderColor-default, var(--color-border-default))",borderRadius:"var(--borderRadius-large)",padding:3},children:[(0,a.jsxs)(l.A,{sx:{display:"flex",alignItems:"baseline",gap:2},children:[(0,a.jsx)(en,{docset:e,size:24}),(0,a.jsx)(m.A,{as:"h3",sx:{fontSize:1,m:0},children:e.name})," ",(0,a.jsx)(u.A,{sx:{fontSize:0,color:"fg.muted"},children:"Knowledge base added to conversation"})]}),(0,a.jsx)(m.A,{as:"h4",sx:{fontSize:0,m:0,color:"fg.muted",fontWeight:"500"},children:"Repositories in this knowledge base"}),(0,a.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:3},children:e.repos.map(e=>(0,a.jsxs)(l.A,{sx:{whiteSpace:"nowrap"},children:[(0,a.jsx)(r.RepoIcon,{}),` ${e}`]},e))})]})}try{ed.displayName||(ed.displayName="TopicPicker")}catch{}try{em.displayName||(em.displayName="TopicDescription")}catch{}try{eu.displayName||(eu.displayName="DocsetDescription")}catch{}let eh=({inputRef:e,showQuotaExceededEmptyState:t})=>{let s=(0,v.Pk)(),{showTopicPicker:n,streamingMessage:i}=s,r="immersive"===s.mode,{scrollToBottom:c}=(0,R.b)(),{messages:d,groupedMessages:m}=(0,g.a)(s);return(0,o.N)(()=>c("instant"),[c]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h2",{className:"sr-only",children:"Copilot Chat"}),t?(0,a.jsx)(Q,{}):n?(0,a.jsx)(ed,{}):(0,a.jsx)(l.A,{sx:{display:"flex",flexDirection:"column",minHeight:"0",flexGrow:1},children:(0,a.jsxs)(l.A,{className:"copilot-messages-container",sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[0===d.length&&(0,a.jsx)("p",{className:_.legalText,children:(0,a.jsx)(B.h,{})}),!r&&!b.W.topicsAsReferences&&(0,a.jsx)(Y,{}),m.map((t,n)=>(0,a.jsx)(w.i,{isLastGroup:n===m.length-1,children:t.map((o,r)=>{let l=n===m.length-1&&r===t.length-1;return(o===i||o.id===y.Wp||!ep(o)||!b.W.dotcomChatClientSideSkills||o.error||eg(o,d,l,s))&&(0,a.jsx)(S.c,{isLatestMessage:l,isFirstReply:1===d.length,isStreaming:o.id===i?.id,message:o,inputRef:e},r)})},n)),s.clientSkillConfirmation&&b.W.dotcomChatClientSideSkills&&(0,a.jsx)("div",{className:"m-3",children:(0,a.jsx)(E.m,{confirmation:s.clientSkillConfirmation,handleConfirmation:e=>s.clientSkillConfirmation?.onSubmit?.("accepted"===e.state),isLatestMessage:!0})})]})})]})},ep=e=>!e.content&&(!e.confirmations||0===e.confirmations.length)&&(!e.clientConfirmations||0===e.clientConfirmations.length),ex=e=>e.clientSkillsRequests&&e.clientSkillsRequests.length>0||e.clientToolResults&&e.clientToolResults.length>0,eg=(e,t,s,n)=>ex(e)&&s&&!n.streamingMessage&&!n.clientSkillConfirmation,ef=()=>(0,a.jsxs)(l.A,{sx:{m:"auto",display:"flex",flexDirection:"column",alignItems:"center",height:"100%",justifyContent:"center"},children:[(0,a.jsx)(c.A,{size:"large"}),(0,a.jsx)(l.A,{sx:{p:3,color:"fg.subtle"},children:"Loading conversation\u2026"})]}),ej=()=>{let{mode:e,reviewLab:t}=(0,v.Pk)();return(0,a.jsxs)(l.A,{sx:{display:"flex",gap:"2",alignItems:"center",py:3,pr:3,pl:"immersive"===e?3:2,color:"fg.subtle"},children:[(0,a.jsx)(h.A,{icon:r.AlertIcon}),"Failed to load previous messages.",t&&(0,a.jsx)(a.Fragment,{children:"\xa0You are in a review lab. Please check that you are connected to the Developer VPN."})]})},ey=({inputRef:e})=>{let t=(0,v.Pk)(),s=(0,C.b)(),{currentReferences:n,messagesLoading:o,messagesRestored:r,threadsLoading:c,currentTopic:d,messages:m,mode:u,selectedThreadID:h,showTopicPicker:g,context:y}=t,_=s.getSelectedThread(t),S=(0,p.useMemo)(()=>(0,f.k4)(Object.keys(N.Pe)).slice(0,4).map(e=>({heading:e,content:(0,f.k4)(N.Pe[e])[0]})),[]),{textAreaRef:w}=(0,x.Y)(e),{chatQuotaExceeded:E,isLicensedLimited:T,reloadQuota:I}=(0,W.x)(),{ambientError:M}=(0,v.Pk)();(0,p.useEffect)(()=>{if(!h||"assistive"===u)return;let e=`${f.Jz}/c/${h}`;window.location.pathname!==e&&0!==m.length&&history.pushState(null,"",e)},[h,u,m.length]);let B=(0,p.useCallback)(async e=>{""!==e.trim()&&(I(),await s.sendChatMessage({thread:_,content:e,references:n,topic:d,context:y,customInstructions:t.customInstructions,skillOptions:t.skillOptions}))},[y,n,d,s,I,t.customInstructions,_,t.skillOptions]),L=r&&m.length>0,D="loading"===o.state&&t.selectedThreadID&&!g&&!L,F="error"===o.state||"error"===c.state,U="loaded"===o.state||L,G=E&&(g||!_),[O]=(0,p.useState)(t.renderAttachKnowledgeBaseHerePopover),Q=(0,j.B)(m),H=!!(!D&&!t.currentTopic&&!g&&0===Q.length&&!O&&0===n.length);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(R.$,{className:"copilot-chat-messages",style:{flex:"1 1 auto"},children:[D&&(0,a.jsx)(ef,{}),F&&(0,a.jsx)(ej,{}),U&&!D&&(0,a.jsx)(eh,{inputRef:w,showQuotaExceededEmptyState:G}),(0,a.jsx)(P.Cb,{})]}),H&&(0,a.jsx)(l.A,{className:"copilot-chat-messages",sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,px:3,mb:3,scrollbarGutter:"stable"},children:S.map((e,n)=>(0,a.jsx)(eb,{heading:e.heading,content:e.content,onSubmit:()=>{s.sendChatMessage({thread:s.getSelectedThread(t),content:e.content,references:t.currentReferences,topic:t.currentTopic,context:t.context}),(0,i.BI)("copilot_chat_suggestion_click",{topic:t.currentTopic?.name})}},n))}),!D&&!g&&!G&&(0,a.jsx)(l.A,{className:"copilot-chat-input copilot-chat-input-outer",sx:{display:"flex",flexDirection:"column",mt:"auto",px:3,pb:3,zIndex:1},children:E?(0,a.jsx)($,{}):(0,a.jsxs)(a.Fragment,{children:[!H&&0===Q.length&&!t.showTopicPicker&&(0,a.jsx)(z,{suggestionKind:"initial"}),(0,a.jsxs)("div",{children:[T&&(0,a.jsx)(J,{}),M&&(0,a.jsx)(A.P,{ambientError:M}),!b.W.topicsAsReferences&&(0,a.jsx)(Z,{}),(0,a.jsx)(k.V,{textAreaRef:w,onSubmit:B,isStreaming:!!t.streamingMessage,size:"small"},h)]})]})}),(0,a.jsx)(P.zc,{})]})};function eb({heading:e,content:t,onSubmit:s}){return(0,a.jsxs)(d.Q,{sx:{bg:"canvas.default",height:"auto",minWidth:"auto",borderBottom:"1px solid",borderColor:"border.default",border:"1px solid var(--borderColor-default, var(--color-border-default))",flex:"1 1 49%",display:"flex",flexDirection:"column",justifyContent:"center",p:2},onClick:s,children:[(0,a.jsx)(m.A,{as:"h3",sx:{textAlign:"center",fontSize:1,m:0,mb:1,wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"normal"},children:e}),(0,a.jsx)(u.A,{as:"p",sx:{fontSize:0,fontWeight:400,textAlign:"center",color:"fg.muted",m:0,textWrap:"balance",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"normal"},children:t})]})}try{eh.displayName||(eh.displayName="Messages")}catch{}try{ef.displayName||(ef.displayName="Loading")}catch{}try{ej.displayName||(ej.displayName="Error")}catch{}try{ey.displayName||(ey.displayName="Chat")}catch{}try{eb.displayName||(eb.displayName="SuggestedPrompt")}catch{}},78176:(e,t,s)=>{s.d(t,{c:()=>z});var n=s(74848),a=s(15294),i=s(26514),o=s(62456),r=s(46988),l=s(34407),c=s(53949),d=s(38621),m=s(75177),u=s(52464),h=s(20053),p=s(96540),x=s(89151),g=s(82610),f=s(2622),j=s(65615),y=s(7426),b=s(1088),v=s(79929),C=s(72659),N=s(66349),A=s(72160),_=s(67264),k=s(61982),S=s(47920),w=s(32132),R=s(79887),E=s(82005),T=s(4181),I=s(50260);let M=({isLatestMessage:e,isFirstReply:t,isStreaming:s,...M})=>{let{message:z}=(0,C.V)(),B=(0,j.Pk)(),P=(0,y.b)(),{author:W,handleConfirmationAction:L,handleRetryErrorMessage:D,hasClientConfirmations:F,isAI:U,isCopilot:$,isError:G,isAgentError:O,isInterrupted:Q,isLoading:H,isUser:q,myRef:J,onFeedbackSubmitted:K,renderContentArea:Y,rendererConfig:V,renderFeedback:Z,shouldShowMessageActions:X,skillExecutionToUseForRespondingText:ee,showRetryButton:et}=(0,x.p)({excludeFeedback:M.excludeFeedback,inputRef:M.inputRef,isLatestMessage:e,isLoading:M.isLoading,isStreaming:s,excludeReferencesFromFocusZone:!0}),es=z.clientToolResults&&z.clientToolResults.length>0,en=z.clientSkillsRequests&&z.clientSkillsRequests.length>0,ea=q&&!es,ei=H||es||en,eo=ei&&e,er=$||es,el=(0,p.useMemo)(()=>(0,g.rT)(z.references??[]),[z.references]),ec=(0,p.useMemo)(()=>P.maxMessagesReached(),[P]),ed=(0,p.useMemo)(()=>z.mediaContent?.find(e=>e.mediaType.startsWith("image/")),[z.mediaContent]),em=(0,p.useMemo)(()=>f.W.attachImagesImmersive&&void 0!==ed||!1,[ed]),eu=(0,p.useCallback)(e=>{let t=e.target.href,s=el.find(e=>e.url===t);s&&"immersive"===B.mode&&(P.selectReference(s),e.preventDefault())},[P,el,B.mode]);return(0,n.jsxs)("div",{className:(0,h.$)("message-container",v.A.messageContainer,ea&&v.A.user,U&&v.A.ai),ref:J,...(0,c.G)(`message-${G?"error":s?"streaming":z.id}`),children:[ea&&em&&(0,n.jsx)(b.o,{src:ed?.url||"",alt:"Uploaded image",mode:B.mode}),er||es?(0,n.jsx)(_.W,{isLoading:ei&&e,isError:G&&z.error?.type!=="agentUnauthorized",mode:B.mode,isFirstMessage:t,isLoadingSkills:(z.skillExecutions??[]).length>0&&ei&&""===z.content&&e,message:z.content||"",createdAt:z.createdAt}):U?(0,n.jsx)("div",{className:v.A.avatar,children:(0,n.jsx)(o.r,{src:W.avatarURL,size:24,"aria-label":`${W.name} avatar`,alt:`${W.name} avatar`,"data-testid":"chat-message-author-avatar"})}):null,ea&&(0,n.jsx)(N.t,{size:"small",align:"right",className:"mb-2",references:el}),(0,n.jsxs)("div",{className:(0,h.$)(v.A.message,ea&&v.A.user),children:[F&&z.clientConfirmations?.length?(0,n.jsx)(m.A,{className:"my-1",sx:{display:"flex",alignItems:"baseline",justifyContent:ea?"flex-end":""},"data-testid":"chat-message-client-confirmations",children:(0,n.jsxs)(u.A,{sx:{fontWeight:"normal",color:"var(--fgColor-muted)"},children:[(0,n.jsx)(d.CheckIcon,{})," ",W.name," ",z.clientConfirmations?.[0]?.state," the action"]})}):null,$&&eo&&ee&&!z.content&&(0,n.jsx)(I.b,{className:(0,h.$)(v.A.skillExecutionText,"mb-2 mt-1 ml-2"),children:`${(0,w.WA)(ee)}...`}),(0,n.jsxs)("div",{className:(0,h.$)(v.A.messageContent,!!F&&v.A.hasClientConfirmations),children:[er&&e&&!Y&&!ee?(0,n.jsx)("span",{className:v.A.blinkingCursor,children:"\u258B"}):null,Y&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(m.A,{className:"js-snippet-clipboard-copy-unpositioned",sx:{fontSize:1,px:2,py:1,zIndex:1,".snippet-clipboard-content":{position:"relative",overflow:"auto",display:"flex",justifyContent:"space-between",backgroundColor:"canvas.subtle",marginBottom:3,zIndex:1,pre:{marginBottom:0},"clipboard-copy":{width:"28px",height:"28px"}}},children:["assistant"===z.role&&(el?.length?(0,n.jsx)(N.s,{className:"mb-3",references:el}):null),$&&M.isLoading?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.O,{variant:"rounded",height:"12px",width:"random"}),(0,n.jsx)(l.O,{variant:"rounded",height:"12px",width:"random"}),(0,n.jsx)(l.O,{variant:"rounded",height:"12px",width:"random"})]}):!F&&(ea?(0,n.jsx)(T.R,{children:z.content??""}):(0,n.jsx)(a.To,{markdown:z.content??"",onLinkClick:eu,chatMode:"assistive",...V})),G?(0,n.jsx)(k.K,{manager:P}):null,O&&z.agentErrors?.length?(0,n.jsx)(k.h,{errors:z.agentErrors}):null,Q?(0,n.jsx)(R.h,{messageHasContent:!!z.content||!!z.skillExecutions?.length}):null,($||(0,g.yh)(W))&&(0,g.Ye)(z.confirmations).map((t,s)=>"indexrepo"===t.confirmation.name?null:(0,n.jsx)(A.m,{confirmation:t,handleConfirmation:L,isLatestMessage:e},s))]}),!X&&et&&(0,n.jsx)(E.$,{handleRetryMessage:D,disabled:ec}),X&&(0,n.jsxs)(m.A,{className:"message-actions","data-testid":"message-action-bar",sx:{display:"inline-flex",alignItems:"center",position:e?void 0:"absolute",bottom:e?void 0:"-2.25rem",borderRadius:e?void 0:2,boxShadow:e?void 0:"var(--shadow-floating-small)",opacity:e?void 0:0,pointerEvents:e?void 0:"none","&::before":{content:e?void 0:'""',inset:"-0.5rem -0.75rem",zIndex:-1,position:"absolute"}},children:[Z&&(0,n.jsx)(S.G,{iconSize:"small",returnFocusRef:J,onFeedbackSubmitted:K}),$&&!!z.content&&!s&&(0,n.jsx)(i.T,{textToCopy:z.content??"",ariaLabel:"Copy to clipboard",size:"small",className:"d-flex flex-items-center",onCopy:()=>{(0,r.BI)("copilot_chat.activate",{target:"CHAT_MESSAGE_COPY",mode:B.mode})}}),et&&(0,n.jsx)(E.$,{handleRetryMessage:D,disabled:ec})]})]})]})]})]})},z=({message:e,...t})=>(0,n.jsx)(C.$,{message:e,children:(0,n.jsx)(M,{...t})});try{M.displayName||(M.displayName="InnerChatMessage")}catch{}try{z.displayName||(z.displayName="ChatMessage")}catch{}}}]);
//# sourceMappingURL=ui_packages_copilot-chat_components_Chat_tsx-aede97763252.js.map